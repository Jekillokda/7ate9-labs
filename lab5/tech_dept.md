# Технический долг

Анализ по состонию на 07.04.18, latest commit 4bb2b9a. 

Оценки производятся в SP, равных одному человеко-часу. 

## Анализ

### 1. Оформление

1. **WHAT**: Сопроводительные документы (github wiki) неструктурированы. Вперемежку лежат документы, относящиеся к процессу разработки (sprint_schedule), к заданиям на лабораторную (lab_tasks, tech_dept) и к деталям реализации (api).

   **TO BE**: Документы должны быть разложены по соответствующим папкам

   **COST**: 0.5

   **PRIORITY**: `MINOR`

2. **WHAT**: Состояние доски 4 спринта не соответствует реальному положению дел.

   TO BE: Создать соответствующе заданиям карточки и указать на них текущий статус выполнения.

   **COST**: 2 

   **PRIORITY**: `MAJOR`

3. **WHAT**: Отстутствие лицензирования исходного кода.

   **TO BE**: В корне проекта должен храится файл `LICENSE` с подходящим лицензионным соглашением

   **COST**: 2

   **PRIORITY**: `NORMAL`

4. **WHAT**: Данный документ не закоммичен уже несколько дней.

   **TO BE**: Данный документ должен быть закоммичен.

   **COST**: 0.0001

   **PRIORITY**: `MAJOR`

5. **WHAT**: Ветка `tcp` выполнила свою задачу, но все ещё присутствует. 

   **TO BE**: Ветка должна быть смержена с веткой `master` и удалена.

   **COST**: 1

   **PRIORITY**: `MAJOR`

### 2. Исходный код

1. **WHAT**: В папке `test` находятся классы, не являющиеся unit-тестами. 

   **TO BE**: В папке `test` должны находиться только unit-тесты. Нужно либо удалить лишние классы, либо перенести их более подходящее место

   **COST**: 0.5

   **PRIORITY**: `NORMAL`

2. **WHAT**: Наличие 2 пометок `TODO` в коде. 

   **TO BE**: Такие пометки допустимы и не являются техническим долгом, если были использованы чтобы обозначить места, требующие проработки в последующих спринтах. Анализ показал, что текущие `TODO` могли быть реализованы ранее и поэтому считаются долгом.

   **COST**: 1

   **PRIORITY**: `NORMAL`

3. **WHAT**: Низкое покрытие документацией (javadoc). По мере разработки документация писалась, но её наличие по проекту неравномерно.

   **TO BE**: Все классы должны содежать javadoc комментарии с описанием назначения

   **COST**: 5

   **PRIORITY**: `MINOR`

4. **WHAT**: Файл `environment.properties` загружен на github. Он содержит порт и адрес приложения и может быть использован для атак.

   **TO BE**: Файл должен быть удален и добавлен в `.gitignore`, а в коде сделаны соответствующие проверки

   **COST**: 0.5

   **PRIORITY**: `MAJOR`

5. **WHAT**: Отстутствие статического анализатора кодав проекте.

   **TO BE**: Настроить FindBugs/PMD/CheckStyle/Crucible

   **COST**: 2

   **PRIORITY**: `NORMAL`

6. **WHAT**: Код клиента должен быть вынесен в отдельный модуль и предоставлять высокоуровневый API. Основания:

   * Дублируется в нескольких местах: на android-клиенте, на тестовом javafx-клиенте и потенциально может быть использован в AI в будущих спринтах.
   * Код на клиенте работает с низкоуровневым API сетевого фреймворка netty. Необходимо упростить API. 

   **TO BE**: Код сетевого клиента должен быть вынесен в отдельный модуль.

   **COST**: 4

   **PRIORITY**: `NORMAL`

### 3. Процессы разработки

1. **WHAT**: Полное отстутствие unit-тестов. 

   **TO BE**: Настроить инструмент анализа покрытия тестами и достичь покрытия 50%.

   **COST**: 8

   **PRIORITY**: `MAJOR`

2. **WHAT**: Отсутствие системы непрерывной интеграции.

   **TO BE**: В рамках следующего спринта настроить Travis. 

   **COST**: 4

   **PRIORITY**: `NORMAL`

3. **WHAT**: Нет возможности изменить ip сервера, после сборки приложения.
   **TO BE**: После запуска приложения должна быть возможность изменить ip сервера.
   **COST**: 3
   **PRIORITY**: `MAJOR`

## Оценка и план

Максимальным допустимым уровнем долга примем 30% от общей стоимости спринта в SP. Для 4 спринта составляет 54*0.3 = **17**.

Минимальным уровнем долга, когда о нем можно не беспокоится, примем 10% от общей стоимости спринта в SP. Для 4 спринта составляет 54*0.1 = 6.

Текущее состояние отажено в таблице. 

| MINOR | NORMAL | MAJOR |
| ----- | ------ | ----- |
| 5.5   | 15.5   | 11.5  |

К сожалению, объем долга, равный **35.5** составляет почти 50% процентов стоимости текущего спринта :(. Выводы:

1. Долг нужно срочно закрывать.
2. Долг нельзя закрыть целиком (иначе не хватит времени на реализацию цели спринта), поэтому нужно отобрать самые важные проблемы. 

К счастью (так себе счатье, конечно) во время анализа для каждой задачи был оценен её приоритет. Поэтому в первую очередь должны быть ликвидированы `MAJOR`-долги, затем `NORMAL`, и, наконец, `MINOR`. 

Цель работы по ликвидации долга — понизить его до 15, то есть закрыть **20.5** очков. После закрытия `MAJOR` останется 6 очков. Было решено ликвидировать следующие долги: 

* 2.6 (4 очка) — вынесение клиентского модуля. Этот архитектурный рефакторинг необходим и для упрощения тестирования и для реализации AI в следующем спринте.
* 2.2 (1 очко) — избавление от пометок `TODO`. Они касаются функционала ротации карт, реализуемого в этом спринте. 
* 1.3 (2 очка) — лицензирование кода.
* 3.3 (3 очка) — возможность смены IP, после установки приложения.

Избавление от технического долга запланировано на 5 спринт, но часть работ по состоянию на 13.04.18 уже произведена. 